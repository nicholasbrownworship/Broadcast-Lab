<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Sponsor Manager – Ozark Invitational</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Sponsor library manager for the Ozark Invitational broadcast overlays." />

  <style>
    :root {
      --green: #244f3c;
      --green-dark: #163023;
      --gold: #d1a14b;
      --cream: #f5f0e6;
      --bg: #0b0f0d;
      --bg-soft: #111827;
      --panel: #151c1e;
      --panel-soft: #1c2527;
      --muted: #6b7280;
      --text: #f9fafb;
      --radius-lg: 18px;
      --radius-md: 12px;
      --shadow-soft: 0 22px 45px rgba(0, 0, 0, 0.45);
      --shadow-subtle: 0 12px 25px rgba(0, 0, 0, 0.35);
      --border-subtle: 1px solid rgba(255, 255, 255, 0.04);
    }

    * ,
    *::before,
    *::after {
      box-sizing: border-box;
    }

    html,
    body {
      margin: 0;
      padding: 0;
      height: 100%;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background:
        radial-gradient(circle at top, rgba(209, 161, 75, 0.2), transparent 55%),
        radial-gradient(circle at bottom, rgba(36, 79, 60, 0.3), transparent 60%),
        var(--bg);
      color: var(--text);
    }

    a {
      color: inherit;
      text-decoration: none;
    }

    /* SHELL */

    .shell {
      max-width: 1100px;
      margin: 0 auto;
      padding: 16px 16px 24px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 16px;
      background: linear-gradient(135deg, rgba(15, 23, 42, 0.96), rgba(15, 23, 42, 0.85));
      border-radius: 999px;
      box-shadow: var(--shadow-subtle);
      border: 1px solid rgba(148, 163, 184, 0.25);
      backdrop-filter: blur(16px);
      gap: 10px;
      flex-wrap: wrap;
    }

    .brand-lockup {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .brand-mark {
      width: 34px;
      height: 34px;
      border-radius: 999px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 0.95rem;
      text-transform: uppercase;
      color: #f9fafb;
      background: conic-gradient(
        from 200deg,
        #d1a14b,
        #f5f0e6,
        #244f3c,
        #d1a14b
      );
      box-shadow: 0 0 0 2px rgba(15, 23, 42, 0.8);
    }

    .brand-title {
      font-size: 0.9rem;
      letter-spacing: 0.09em;
      text-transform: uppercase;
      font-weight: 600;
    }

    .brand-subtitle {
      font-size: 0.8rem;
      color: var(--muted);
    }

    .topbar-actions {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    .ghost-btn {
      border-radius: 999px;
      padding: 6px 12px;
      font-size: 0.8rem;
      border: 1px solid rgba(148, 163, 184, 0.35);
      background: rgba(15, 23, 42, 0.7);
      color: #e5e7eb;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      transition: background 0.15s ease, border-color 0.15s ease,
        transform 0.08s ease;
    }

    .ghost-btn:hover {
      background: rgba(30, 64, 175, 0.3);
      border-color: rgba(191, 219, 254, 0.9);
      transform: translateY(-1px);
    }

    .tag-label {
      padding: 3px 8px;
      border-radius: 999px;
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      border: 1px solid rgba(148, 163, 184, 0.5);
      color: rgba(203, 213, 225, 0.95);
    }

    /* MAIN GRID */

    .main-grid {
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 1.4fr);
      gap: 16px;
      align-items: flex-start;
      flex: 1;
    }

    .panel {
      background: linear-gradient(145deg, var(--panel), var(--panel-soft));
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-soft);
      border: var(--border-subtle);
      padding: 16px 16px 18px;
    }

    .panel-header {
      margin-bottom: 10px;
    }

    .panel-header h2 {
      margin: 0 0 4px;
      font-size: 0.95rem;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: #e5e7eb;
    }

    .panel-subtitle {
      margin: 0;
      font-size: 0.8rem;
      color: var(--muted);
    }

    .panel-divider {
      border: none;
      border-top: 1px solid rgba(148, 163, 184, 0.4);
      margin: 12px 0 10px;
    }

    /* FORM */

    .field {
      display: flex;
      flex-direction: column;
      gap: 3px;
    }

    .field-label {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--muted);
    }

    .required {
      color: #f97373;
      margin-left: 2px;
    }

    input[type="text"],
    input[type="number"],
    select {
      border-radius: var(--radius-md);
      border: 1px solid rgba(148, 163, 184, 0.4);
      padding: 7px 10px;
      background: rgba(15, 23, 42, 0.86);
      color: #f9fafb;
      font-size: 0.85rem;
      outline: none;
      transition: border-color 0.12s ease, box-shadow 0.12s ease,
        background 0.12s ease;
    }

    input[type="text"]:focus,
    input[type="number"]:focus,
    select:focus {
      border-color: rgba(96, 165, 250, 0.9);
      box-shadow: 0 0 0 1px rgba(96, 165, 250, 0.8);
    }

    input[type="number"] {
      max-width: 120px;
    }

    .field-inline {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.8rem;
    }

    .field-inline input[type="checkbox"] {
      width: 16px;
      height: 16px;
      border-radius: 4px;
      accent-color: #22c55e;
    }

    .field-grid {
      display: grid;
      grid-template-columns: minmax(0, 1fr);
      gap: 10px;
    }

    .field-grid--two {
      grid-template-columns: minmax(0, 1fr) minmax(0, 1fr);
    }

    .button-row {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-top: 10px;
      flex-wrap: wrap;
    }

    .primary-btn {
      border-radius: 999px;
      padding: 7px 14px;
      font-size: 0.85rem;
      border: none;
      cursor: pointer;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      font-weight: 600;
      background: linear-gradient(135deg, #d1a14b, #f5f0e6);
      color: #111827;
      box-shadow: 0 14px 30px rgba(15, 23, 42, 0.7);
      transition: transform 0.08s ease, box-shadow 0.08s ease,
        filter 0.08s ease;
    }

    .primary-btn:hover {
      transform: translateY(-1px);
      filter: brightness(1.05);
      box-shadow: 0 16px 34px rgba(15, 23, 42, 0.85);
    }

    .secondary-btn {
      border-radius: 999px;
      padding: 6px 12px;
      font-size: 0.8rem;
      border: 1px solid rgba(148, 163, 184, 0.45);
      background: rgba(15, 23, 42, 0.72);
      color: #e5e7eb;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 5px;
      transition: background 0.15s ease, border-color 0.15s ease,
        transform 0.08s ease;
    }

    .secondary-btn:hover {
      background: rgba(30, 64, 175, 0.35);
      border-color: rgba(191, 219, 254, 0.9);
      transform: translateY(-1px);
    }

    .danger-btn {
      border-radius: 999px;
      padding: 4px 10px;
      font-size: 0.75rem;
      border: 1px solid rgba(248, 113, 113, 0.8);
      background: rgba(127, 29, 29, 0.85);
      color: #fee2e2;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      transition: background 0.15s ease, border-color 0.15s ease,
        transform 0.08s ease;
    }

    .danger-btn:hover {
      background: rgba(153, 27, 27, 0.95);
      border-color: rgba(254, 202, 202, 0.9);
      transform: translateY(-1px);
    }

    .muted-text {
      font-size: 0.75rem;
      color: var(--muted);
    }

    .status-text {
      margin-top: 6px;
      font-size: 0.78rem;
      color: rgba(196, 181, 253, 0.95);
    }

    .status-text.error {
      color: #fecaca;
    }

    /* CURRENT SPONSOR PANEL */

    .current-sponsor-card {
      margin-top: 10px;
      padding: 10px 12px;
      border-radius: 14px;
      background: radial-gradient(circle at top left, rgba(209, 161, 75, 0.18), transparent 60%),
        rgba(15, 23, 42, 0.96);
      border: 1px solid rgba(148, 163, 184, 0.5);
      display: flex;
      flex-direction: column;
      gap: 3px;
    }

    .current-label {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: rgba(148, 163, 184, 0.95);
    }

    .current-name {
      font-size: 0.9rem;
      font-weight: 600;
    }

    .current-line {
      font-size: 0.8rem;
      color: rgba(226, 232, 240, 0.9);
    }

    .current-tier {
      font-size: 0.72rem;
      color: rgba(148, 163, 184, 0.95);
      text-transform: uppercase;
      letter-spacing: 0.14em;
    }

    /* LIST PANEL */

    .list-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 8px;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 3px 9px;
      border-radius: 999px;
      font-size: 0.75rem;
      border: 1px solid rgba(148, 163, 184, 0.5);
      color: rgba(209, 213, 219, 0.95);
    }

    .pill-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #22c55e;
    }

    .pill-dot.off {
      background: #6b7280;
    }

    .table-wrapper {
      margin-top: 6px;
      border-radius: 14px;
      border: 1px solid rgba(30, 41, 59, 0.9);
      background: radial-gradient(circle at top left, rgba(15, 23, 42, 0.9), rgba(15, 23, 42, 0.98));
      max-height: 420px;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .table-scroll {
      overflow-y: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.78rem;
    }

    thead {
      position: sticky;
      top: 0;
      z-index: 1;
      background: rgba(15, 23, 42, 0.98);
    }

    th,
    td {
      padding: 7px 10px;
      text-align: left;
      border-bottom: 1px solid rgba(30, 41, 59, 0.9);
    }

    th {
      font-size: 0.72rem;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      color: rgba(148, 163, 184, 0.95);
      white-space: nowrap;
    }

    tbody tr:last-child td {
      border-bottom: none;
    }

    tbody tr:nth-child(odd) {
      background: rgba(15, 23, 42, 0.92);
    }

    tbody tr:nth-child(even) {
      background: rgba(15, 23, 42, 0.96);
    }

    .row-current {
      box-shadow: inset 2px 0 0 #d1a14b;
      background: linear-gradient(
        90deg,
        rgba(209, 161, 75, 0.12),
        rgba(15, 23, 42, 0.98)
      );
    }

    .row-inactive td {
      opacity: 0.65;
    }

    .col-actions {
      white-space: nowrap;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .tier-badge {
      padding: 2px 7px;
      border-radius: 999px;
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      border: 1px solid rgba(148, 163, 184, 0.6);
      color: rgba(226, 232, 240, 0.96);
    }

    .tier-presenting {
      border-color: rgba(250, 204, 21, 0.9);
      color: #facc15;
    }

    .tier-feature {
      border-color: rgba(56, 189, 248, 0.9);
      color: #7dd3fc;
    }

    .tier-segment {
      border-color: rgba(52, 211, 153, 0.9);
      color: #6ee7b7;
    }

    .tier-cart {
      border-color: rgba(248, 113, 113, 0.9);
      color: #fecaca;
    }

    .badge-active {
      padding: 2px 6px;
      border-radius: 999px;
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      background: rgba(22, 101, 52, 0.95);
      color: #bbf7d0;
    }

    .badge-inactive {
      padding: 2px 6px;
      border-radius: 999px;
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      background: rgba(55, 65, 81, 0.9);
      color: #e5e7eb;
    }

    .empty-state {
      padding: 10px 12px;
      font-size: 0.8rem;
      color: var(--muted);
    }

    /* FOOTER */

    .footer {
      margin-top: 6px;
      padding-top: 6px;
      border-top: 1px dashed rgba(148, 163, 184, 0.4);
      font-size: 0.75rem;
      color: var(--muted);
      display: flex;
      align-items: center;
      gap: 4px;
      flex-wrap: wrap;
    }

    .footer .dot {
      opacity: 0.8;
    }

    /* RESPONSIVE */

    @media (max-width: 900px) {
      .main-grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    @media (max-width: 640px) {
      .topbar {
        flex-direction: column;
        align-items: flex-start;
      }
      .field-grid--two {
        grid-template-columns: minmax(0, 1fr);
      }
    }
  </style>
</head>
<body>
  <div class="shell">
    <!-- TOPBAR -->
    <header class="topbar">
      <div class="brand-lockup">
        <div class="brand-mark">OI</div>
        <div>
          <div class="brand-title">Ozark Invitational</div>
          <div class="brand-subtitle">Sponsor Manager</div>
        </div>
      </div>
      <div class="topbar-actions">
        <span class="tag-label">Overlay Sponsor Library</span>
        <a href="index.html" class="ghost-btn">← Back to Broadcast Lab</a>
      </div>
    </header>

    <main class="main-grid">
      <!-- LEFT: FORM -->
      <section class="panel">
        <div class="panel-header">
          <h2>Edit Sponsor</h2>
          <p class="panel-subtitle">
            Build a reusable sponsor library. These entries will be read by the Broadcast Lab for quick on-air use.
          </p>
        </div>

        <form id="sponsorForm">
          <input type="hidden" id="sponsorId" />

          <div class="field-grid">
            <div class="field">
              <label class="field-label" for="sponsorName">
                Sponsor name <span class="required">*</span>
              </label>
              <input
                type="text"
                id="sponsorName"
                placeholder="+3 Golf Co."
                autocomplete="off"
              />
            </div>

            <div class="field">
              <label class="field-label" for="sponsorTier">
                Tier / role <span class="required">*</span>
              </label>
              <select id="sponsorTier">
                <option value="presenting">Presenting Sponsor</option>
                <option value="feature">Feature Segment</option>
                <option value="segment">Segment / Desk</option>
                <option value="cart">Cart Cam / Mic'd Up</option>
                <option value="other">Other</option>
              </select>
            </div>
          </div>

          <div class="field" style="margin-top:10px;">
            <label class="field-label" for="sponsorLine">
              On-air line <span class="required">*</span>
            </label>
            <input
              type="text"
              id="sponsorLine"
              placeholder="Presented by +3 Golf Co."
              autocomplete="off"
            />
            <p class="muted-text">
              This is exactly what will appear in the lower thirds, matchup bar, or coming-up slate.
            </p>
          </div>

          <div class="field-grid field-grid--two" style="margin-top:10px;">
            <div class="field">
              <label class="field-label" for="sponsorLogo">
                Logo URL (optional)
              </label>
              <input
                type="text"
                id="sponsorLogo"
                placeholder="images/sponsors/plus3.png"
                autocomplete="off"
              />
            </div>

            <div class="field">
              <label class="field-label" for="sponsorWeight">
                Rotation weight
              </label>
              <input
                type="number"
                id="sponsorWeight"
                min="1"
                step="1"
                value="1"
              />
              <p class="muted-text">
                Higher weight = appears more often in future auto-rotation.
              </p>
            </div>
          </div>

          <div class="field-inline" style="margin-top:8px;">
            <input type="checkbox" id="sponsorActive" checked />
            <label for="sponsorActive">Active sponsor (eligible for on-air use)</label>
          </div>

          <div class="button-row">
            <button type="submit" class="primary-btn" id="saveBtn">
              Save sponsor
            </button>
            <button type="button" class="secondary-btn" id="clearBtn">
              Clear form
            </button>
          </div>

          <p class="status-text" id="formStatus"></p>
        </form>

        <hr class="panel-divider" />

        <div class="current-sponsor-card" id="currentSponsorCard">
          <div class="current-label">Current on-air sponsor</div>
          <div class="current-name" id="currentSponsorName">None selected</div>
          <div class="current-line" id="currentSponsorLine">
            Use the sponsor list to set one as current.
          </div>
          <div class="current-tier" id="currentSponsorTier"></div>
        </div>
      </section>

      <!-- RIGHT: LIST -->
      <section class="panel">
        <div class="list-header">
          <div>
            <div class="panel-header" style="margin-bottom:0;">
              <h2>Sponsor Library</h2>
              <p class="panel-subtitle">
                All sponsors saved here can be pulled into the Broadcast Lab via local storage.
              </p>
            </div>
          </div>
          <div>
            <div class="pill">
              <span class="pill-dot"></span>
              <span id="activeCountLabel">0 active</span>
            </div>
          </div>
        </div>

        <div class="table-wrapper">
          <div class="table-scroll">
            <table>
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Tier</th>
                  <th>Status</th>
                  <th>Weight</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="sponsorTableBody">
                <!-- rows injected by JS -->
              </tbody>
            </table>
          </div>

          <div id="emptyState" class="empty-state" style="display:none;">
            No sponsors yet. Add your first sponsor on the left — for example,
            <strong>+3 Golf Co.</strong> as the Presenting Sponsor.
          </div>
        </div>

        <p class="muted-text" style="margin-top:8px;">
          This page stores sponsors in your browser only using
          <strong>localStorage</strong>. Once filled out, open the Broadcast Lab
          and it can read from this same library for quick on-air sponsor selection.
        </p>
      </section>
    </main>

    <footer class="footer">
      <span>Ozark Invitational Tools</span>
      <span class="dot">&middot;</span>
      <span>Sponsor library powers overlays across the Broadcast Lab</span>
    </footer>
  </div>

  <script>
    (function () {
      const SPONSOR_KEY = "ozarkSponsors_v1";
      const CURRENT_SPONSOR_KEY = "ozarkCurrentSponsorId_v1";

      function $(sel) { return document.querySelector(sel); }
      function $all(sel) { return Array.from(document.querySelectorAll(sel)); }

      const form = $("#sponsorForm");
      const sponsorIdInput = $("#sponsorId");
      const nameInput = $("#sponsorName");
      const tierSelect = $("#sponsorTier");
      const lineInput = $("#sponsorLine");
      const logoInput = $("#sponsorLogo");
      const weightInput = $("#sponsorWeight");
      const activeCheckbox = $("#sponsorActive");
      const saveBtn = $("#saveBtn");
      const clearBtn = $("#clearBtn");
      const formStatus = $("#formStatus");

      const tableBody = $("#sponsorTableBody");
      const emptyState = $("#emptyState");
      const activeCountLabel = $("#activeCountLabel");

      const currentCard = $("#currentSponsorCard");
      const currentName = $("#currentSponsorName");
      const currentLine = $("#currentSponsorLine");
      const currentTier = $("#currentSponsorTier");

      let sponsors = [];
      let currentSponsorId = null;

      // Utils
      function loadSponsors() {
        try {
          const raw = localStorage.getItem(SPONSOR_KEY);
          if (!raw) return [];
          const parsed = JSON.parse(raw);
          if (!Array.isArray(parsed)) return [];
          return parsed;
        } catch (e) {
          console.error("Error loading sponsors", e);
          return [];
        }
      }

      function saveSponsors() {
        try {
          localStorage.setItem(SPONSOR_KEY, JSON.stringify(sponsors));
        } catch (e) {
          console.error("Error saving sponsors", e);
        }
      }

      function loadCurrentSponsorId() {
        try {
          return localStorage.getItem(CURRENT_SPONSOR_KEY) || null;
        } catch (e) {
          return null;
        }
      }

      function saveCurrentSponsorId(id) {
        currentSponsorId = id;
        try {
          if (id) {
            localStorage.setItem(CURRENT_SPONSOR_KEY, id);
          } else {
            localStorage.removeItem(CURRENT_SPONSOR_KEY);
          }
        } catch (e) {
          console.error("Error saving current sponsor id", e);
        }
      }

      function makeId() {
        return "sp_" + Math.random().toString(36).slice(2, 9);
      }

      // Rendering

      function tierClass(tier) {
        switch (tier) {
          case "presenting": return "tier-presenting";
          case "feature": return "tier-feature";
          case "segment": return "tier-segment";
          case "cart": return "tier-cart";
          default: return "";
        }
      }

      function tierLabel(tier) {
        switch (tier) {
          case "presenting": return "Presenting";
          case "feature": return "Feature";
          case "segment": return "Segment";
          case "cart": return "Cart / Cam";
          case "other": return "Other";
          default: return "Unknown";
        }
      }

      function resetStatus(delay = 2500) {
        if (!formStatus) return;
        if (!formStatus.textContent.trim()) return;
        const text = formStatus.textContent;
        const isError = formStatus.classList.contains("error");
        setTimeout(() => {
          if (formStatus.textContent === text) {
            formStatus.textContent = "";
            formStatus.classList.remove("error");
          }
        }, delay);
      }

      function setStatus(msg, isError = false) {
        if (!formStatus) return;
        formStatus.textContent = msg || "";
        formStatus.classList.toggle("error", !!isError);
        if (msg) resetStatus();
      }

      function renderList() {
        tableBody.innerHTML = "";

        if (!Array.isArray(sponsors) || sponsors.length === 0) {
          emptyState.style.display = "block";
          activeCountLabel.textContent = "0 active";
          return;
        } else {
          emptyState.style.display = "none";
        }

        // Sort by: active first, then tier, then name
        const tierOrder = ["presenting", "feature", "segment", "cart", "other"];
        const sorted = sponsors.slice().sort((a, b) => {
          if (a.active !== b.active) return a.active ? -1 : 1;
          const ta = tierOrder.indexOf(a.tier);
          const tb = tierOrder.indexOf(b.tier);
          if (ta !== tb) return ta - tb;
          return (a.name || "").localeCompare(b.name || "");
        });

        let activeCount = 0;

        sorted.forEach(sp => {
          if (sp.active) activeCount++;

          const tr = document.createElement("tr");
          if (!sp.active) tr.classList.add("row-inactive");
          if (sp.id && sp.id === currentSponsorId) {
            tr.classList.add("row-current");
          }

          const tdName = document.createElement("td");
          tdName.textContent = sp.name || "(Unnamed sponsor)";
          tr.appendChild(tdName);

          const tdTier = document.createElement("td");
          const tierSpan = document.createElement("span");
          tierSpan.className = "tier-badge " + tierClass(sp.tier);
          tierSpan.textContent = tierLabel(sp.tier);
          tdTier.appendChild(tierSpan);
          tr.appendChild(tdTier);

          const tdStatus = document.createElement("td");
          const statusSpan = document.createElement("span");
          statusSpan.className = sp.active ? "badge-active" : "badge-inactive";
          statusSpan.textContent = sp.active ? "Active" : "Inactive";
          tdStatus.appendChild(statusSpan);
          tr.appendChild(tdStatus);

          const tdWeight = document.createElement("td");
          tdWeight.textContent = sp.weight != null ? String(sp.weight) : "1";
          tr.appendChild(tdWeight);

          const tdActions = document.createElement("td");
          tdActions.className = "col-actions";

          const btnSetCurrent = document.createElement("button");
          btnSetCurrent.type = "button";
          btnSetCurrent.className = "secondary-btn";
          btnSetCurrent.textContent = "Set current";
          btnSetCurrent.addEventListener("click", () => {
            setCurrentSponsor(sp.id);
          });

          const btnToggle = document.createElement("button");
          btnToggle.type = "button";
          btnToggle.className = "secondary-btn";
          btnToggle.textContent = sp.active ? "Deactivate" : "Activate";
          btnToggle.addEventListener("click", () => {
            toggleActive(sp.id);
          });

          const btnEdit = document.createElement("button");
          btnEdit.type = "button";
          btnEdit.className = "secondary-btn";
          btnEdit.textContent = "Edit";
          btnEdit.addEventListener("click", () => {
            loadIntoForm(sp.id);
          });

          const btnDelete = document.createElement("button");
          btnDelete.type = "button";
          btnDelete.className = "danger-btn";
          btnDelete.textContent = "Delete";
          btnDelete.addEventListener("click", () => {
            deleteSponsor(sp.id);
          });

          tdActions.appendChild(btnSetCurrent);
          tdActions.appendChild(btnToggle);
          tdActions.appendChild(btnEdit);
          tdActions.appendChild(btnDelete);

          tr.appendChild(tdActions);

          tableBody.appendChild(tr);
        });

        activeCountLabel.textContent = activeCount + " active";
        renderCurrentCard();
      }

      function renderCurrentCard() {
        if (!currentSponsorId) {
          currentName.textContent = "None selected";
          currentLine.textContent = "Use the sponsor list to set one as current.";
          currentTier.textContent = "";
          return;
        }
        const sp = sponsors.find(s => s.id === currentSponsorId);
        if (!sp) {
          currentName.textContent = "None selected";
          currentLine.textContent = "Use the sponsor list to set one as current.";
          currentTier.textContent = "";
          return;
        }

        currentName.textContent = sp.name || "(Unnamed sponsor)";
        currentLine.textContent = sp.line || "";
        currentTier.textContent = "Tier: " + tierLabel(sp.tier);
      }

      // Form actions

      function clearForm() {
        sponsorIdInput.value = "";
        nameInput.value = "";
        tierSelect.value = "presenting";
        lineInput.value = "";
        logoInput.value = "";
        weightInput.value = "1";
        activeCheckbox.checked = true;
        saveBtn.textContent = "Save sponsor";
        setStatus("");
      }

      function loadIntoForm(id) {
        const sp = sponsors.find(s => s.id === id);
        if (!sp) return;
        sponsorIdInput.value = sp.id || "";
        nameInput.value = sp.name || "";
        tierSelect.value = sp.tier || "presenting";
        lineInput.value = sp.line || "";
        logoInput.value = sp.logoUrl || "";
        weightInput.value = sp.weight != null ? String(sp.weight) : "1";
        activeCheckbox.checked = sp.active !== false;
        saveBtn.textContent = "Update sponsor";
        setStatus("Loaded sponsor into form. Edit and save to update.");
      }

      function setCurrentSponsor(id) {
        const sp = sponsors.find(s => s.id === id);
        if (!sp) return;
        if (!sp.active) {
          const confirmActivate = confirm(
            "This sponsor is currently inactive. Activate and set as current?"
          );
          if (!confirmActivate) return;
          sp.active = true;
          saveSponsors();
        }
        saveCurrentSponsorId(id);
        setStatus("Set \"" + (sp.name || "Sponsor") + "\" as current on-air sponsor.");
        renderList();
      }

      function toggleActive(id) {
        const sp = sponsors.find(s => s.id === id);
        if (!sp) return;
        sp.active = !sp.active;
        if (!sp.active && currentSponsorId === sp.id) {
          // If you deactivate the current sponsor, clear current
          saveCurrentSponsorId(null);
        }
        saveSponsors();
        renderList();
      }

      function deleteSponsor(id) {
        const sp = sponsors.find(s => s.id === id);
        const name = sp ? sp.name || "this sponsor" : "this sponsor";
        const ok = confirm("Delete " + name + " from the library?");
        if (!ok) return;
        sponsors = sponsors.filter(s => s.id !== id);
        if (currentSponsorId === id) {
          saveCurrentSponsorId(null);
        }
        saveSponsors();
        setStatus("Sponsor deleted.");
        renderList();
      }

      // Form submit

      form.addEventListener("submit", (evt) => {
        evt.preventDefault();

        const name = (nameInput.value || "").trim();
        const tier = (tierSelect.value || "presenting").trim();
        const line = (lineInput.value || "").trim();
        const logoUrl = (logoInput.value || "").trim();
        const weightVal = parseInt(weightInput.value, 10);
        const weight = isNaN(weightVal) || weightVal < 1 ? 1 : weightVal;
        const active = !!activeCheckbox.checked;

        if (!name || !line) {
          setStatus("Name and on-air line are required.", true);
          return;
        }

        const existingId = (sponsorIdInput.value || "").trim();

        if (existingId) {
          // Update
          const sp = sponsors.find(s => s.id === existingId);
          if (!sp) {
            setStatus("Could not find sponsor to update. Try saving as new.", true);
            return;
          }
          sp.name = name;
          sp.tier = tier;
          sp.line = line;
          sp.logoUrl = logoUrl;
          sp.weight = weight;
          sp.active = active;
          saveSponsors();
          setStatus("Sponsor updated.");
        } else {
          // Create
          const id = makeId();
          sponsors.push({
            id,
            name,
            tier,
            line,
            logoUrl,
            weight,
            active,
            createdAt: Date.now()
          });
          saveSponsors();
          sponsorIdInput.value = id;
          saveBtn.textContent = "Update sponsor";
          setStatus("Sponsor saved.");
        }

        renderList();
      });

      clearBtn.addEventListener("click", () => {
        clearForm();
      });

      // Init

      function init() {
        sponsors = loadSponsors();
        currentSponsorId = loadCurrentSponsorId();
        renderList();
        renderCurrentCard();

        if (sponsors.length === 0) {
          // Optional: prefill with a sample sponsor
          nameInput.value = "+3 Golf Co.";
          tierSelect.value = "presenting";
          lineInput.value = "Presented by +3 Golf Co.";
          weightInput.value = "1";
          activeCheckbox.checked = true;
        }
      }

      init();
    })();
  </script>
</body>
</html>
